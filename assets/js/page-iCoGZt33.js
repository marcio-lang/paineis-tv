import{b as e,j as a,B as s,I as t,t as o}from"./index-DgiuPnKP.js";import{r}from"./vendor-DaJCiAzA.js";import{T as l,M as i}from"./Modal-C5T-U6VA.js";import{C as c}from"./Layout-B3msiOoc.js";import{m as n,e as d,P as u,n as m,o as x,D as p,F as g,f as h,d as v,g as j}from"./ui-CTO2A6V9.js";import"./router-C-K4H33B.js";import"./Header-CwMlxLm9.js";const b=()=>{r.useEffect(()=>{},[]);const[b,f]=r.useState([]),[N,y]=r.useState([]),[C,w]=r.useState(null),[P,A]=r.useState(!0),[k,S]=r.useState(""),[O,T]=r.useState(!1),[_,E]=r.useState(!1),[L,R]=r.useState(!1),[D,I]=r.useState(null),[U,M]=r.useState({name:"",price:0,position:1,is_active:!0,codigo:""}),[X,F]=r.useState({}),[H,B]=r.useState({title:"",footer_text:""});r.useEffect(()=>{(async()=>{try{await z(),await q()}catch(e){}})()},[]);const z=async()=>{try{A(!0);const a=await e.getProducts();f(a),y(a)}catch(a){o.error("Erro ao carregar produtos do açougue")}finally{A(!1)}},q=async()=>{try{const a=await e.getConfig();w(a),B({title:(null==a?void 0:a.title)||"",footer_text:(null==a?void 0:a.footer_text)||""})}catch(a){w({polling_interval:10,title:"",footer_text:""}),B({title:"",footer_text:""})}};r.useEffect(()=>{if(k){const e=b.filter(e=>e.name.toLowerCase().includes(k.toLowerCase())||e.codigo.toLowerCase().includes(k.toLowerCase()));y(e)}else y(b)},[k,b]);const J=[{key:"position",label:"Posição",render:e=>a.jsx("span",{className:"inline-flex items-center justify-center w-8 h-8 bg-blue-100 text-blue-800 rounded-full text-sm font-medium",children:e.position})},{key:"codigo",label:"Código",render:e=>a.jsx("div",{className:"font-mono text-sm text-gray-600 bg-gray-100 px-2 py-1 rounded",children:e.codigo})},{key:"name",label:"Nome do Produto",render:e=>a.jsx("div",{className:"font-medium text-gray-900",children:e.name})},{key:"price",label:"Preço",render:s=>a.jsx("div",{className:"font-medium text-green-600",children:e.formatPrice(s.price)})},{key:"is_active",label:"Status",render:e=>a.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium "+(e.is_active?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:e.is_active?"Ativo":"Inativo"})},{key:"created_at",label:"Criado em",render:e=>new Date(e.created_at).toLocaleDateString("pt-BR")},{key:"actions",label:"Ações",render:t=>a.jsxs("div",{className:"flex space-x-2",children:[a.jsx(s,{variant:"ghost",size:"sm",onClick:()=>(e=>{I(e),F({name:e.name,price:e.price,position:e.position,is_active:e.is_active,codigo:e.codigo}),E(!0)})(t),className:"text-yellow-600 hover:text-yellow-700",children:a.jsx(j,{className:"h-4 w-4"})}),a.jsx(s,{variant:"ghost",size:"sm",onClick:()=>(async a=>{var s,t;if(confirm(`Tem certeza que deseja deletar o produto "${a.name}"?`))try{await e.deleteProduct(a.id),o.success("Produto deletado com sucesso!"),z()}catch(r){o.error((null==(t=null==(s=r.response)?void 0:s.data)?void 0:t.error)||"Erro ao deletar produto")}})(t),className:"text-red-600 hover:text-red-700",children:a.jsx(h,{className:"h-4 w-4"})})]})}],$=e.getProductStats(b||[]),W=e.getAvailablePositions(b||[]);return a.jsx(c,{animation:"fade",children:a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Administração do Açougue"}),a.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Gerencie produtos e configurações do painel do açougue"})]}),a.jsxs("div",{className:"flex space-x-3",children:[a.jsxs(s,{variant:"outline",onClick:()=>{window.open("/acougue-tv","_blank")},children:[a.jsx(n,{className:"h-4 w-4 mr-2"}),"Ver Painel TV"]}),a.jsxs(s,{variant:"outline",onClick:()=>{R(!0)},children:[a.jsx(d,{className:"h-4 w-4 mr-2"}),"Configurações"]}),a.jsxs(s,{onClick:()=>T(!0),children:[a.jsx(u,{className:"h-4 w-4 mr-2"}),"Novo Produto"]})]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[a.jsx("div",{className:"bg-white p-6 rounded-lg shadow",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:a.jsx(m,{className:"h-6 w-6 text-blue-600"})}),a.jsxs("div",{className:"ml-4",children:[a.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total de Produtos"}),a.jsx("p",{className:"text-2xl font-bold text-gray-900",children:$.total})]})]})}),a.jsx("div",{className:"bg-white p-6 rounded-lg shadow",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:a.jsx(x,{className:"h-6 w-6 text-green-600"})}),a.jsxs("div",{className:"ml-4",children:[a.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Produtos Ativos"}),a.jsx("p",{className:"text-2xl font-bold text-gray-900",children:$.active})]})]})}),a.jsx("div",{className:"bg-white p-6 rounded-lg shadow",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"p-2 bg-gray-100 rounded-lg",children:a.jsx(m,{className:"h-6 w-6 text-gray-600"})}),a.jsxs("div",{className:"ml-4",children:[a.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Produtos Inativos"}),a.jsx("p",{className:"text-2xl font-bold text-gray-900",children:$.inactive})]})]})}),a.jsx("div",{className:"bg-white p-6 rounded-lg shadow",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"p-2 bg-yellow-100 rounded-lg",children:a.jsx(x,{className:"h-6 w-6 text-yellow-600"})}),a.jsxs("div",{className:"ml-4",children:[a.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Preço Médio"}),a.jsx("p",{className:"text-2xl font-bold text-gray-900",children:e.formatPrice($.averagePrice)})]})]})})]}),a.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Ações Rápidas"}),a.jsxs("div",{className:"flex flex-wrap gap-3",children:[a.jsxs(s,{variant:"outline",onClick:async()=>{var a,s;try{const a=await e.exportData(),s=new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),t=URL.createObjectURL(s),r=document.createElement("a");r.href=t,r.download=`acougue-backup-${(new Date).toISOString().split("T")[0]}.json`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(t),o.success("Dados exportados em JSON com sucesso!")}catch(t){o.error((null==(s=null==(a=t.response)?void 0:a.data)?void 0:s.error)||"Erro ao exportar dados")}},children:[a.jsx(p,{className:"h-4 w-4 mr-2"}),"Exportar JSON"]}),a.jsxs(s,{variant:"outline",onClick:async()=>{var a,s;try{const a=await e.exportDataTxt(),s=new Blob([a],{type:"text/plain"}),t=URL.createObjectURL(s),r=document.createElement("a");r.href=t,r.download=`acougue-produtos-${(new Date).toISOString().split("T")[0]}.txt`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(t),o.success("Dados exportados em TXT com sucesso!")}catch(t){o.error((null==(s=null==(a=t.response)?void 0:a.data)?void 0:s.error)||"Erro ao exportar dados TXT")}},children:[a.jsx(g,{className:"h-4 w-4 mr-2"}),"Exportar TXT"]}),a.jsxs("div",{className:"relative",children:[a.jsx("input",{type:"file",id:"import-file",className:"hidden",accept:".json,.txt",onChange:async a=>{var s,t,r;if(!(null==(s=a.target.files)?void 0:s[0]))return;const l=a.target.files[0],i=l.name.toLowerCase();if(i.endsWith(".json")||i.endsWith(".txt"))try{const a=await l.text();if(i.endsWith(".txt")){const s=[],t=/^(\d{6})(\d{3})(\d{6})(\d{3})([A-Z\s\d]+)\s*kg/,r=a.split("\n");for(let e=0;e<r.length;e++){let a=r[e].trim();if(a){const e=a.match(t);if(e){e[1];const a=e[2],t=e[3];e[4];let o=e[5].trim();const r=parseInt(t)/100;o=o.replace(/^\d+/,""),o=o.trim(),o=o.replace(/\bPAO\b/g,"PÃO"),o=o.replace(/\bFRANCES\b/g,"FRANCÊS"),o=o.replace(/\bFILE\b/g,"FILÉ"),o=o.replace(/\bCOXA\b/g,"COXA"),o=o.replace(/\bSOBRECOXA\b/g,"SOBRECOXA"),o=o.replace(/\bCONTRA\b/g,"CONTRA"),o=o.replace(/\bALCATRA\b/g,"ALCATRA"),o=o.replace(/\bCARTEIRA\b/g,"CARTEIRA"),o=o.replace(/\bPICANHA\b/g,"PICANHA"),o=o.replace(/\bFRALDINHA\b/g,"FRALDINHA"),o=o.replace(/\bCUPIM\b/g,"CUPIM"),o=o.replace(/\bMUSCULO\b/g,"MÚSCULO"),o=o.replace(/\bPATINHO\b/g,"PATINHO"),o=o.replace(/\bCOXAO\b/g,"COXÃO"),o=o.replace(/\bMAMINHA\b/g,"MAMINHA");const l={codigo:a,name:o.toLowerCase().replace(/\b\w/g,e=>e.toUpperCase()),price:r,position:s.length+1,is_active:!0};s.push(l)}}}if(0===s.length)return void o.error("Nenhum produto válido encontrado no arquivo TXT!");await e.importData({produtos:s}),o.success(`${s.length} produtos importados com sucesso do arquivo TXT!`)}else{const s=JSON.parse(a);await e.importData(s),o.success("Dados importados com sucesso do arquivo JSON!")}z()}catch(c){o.error((null==(r=null==(t=c.response)?void 0:t.data)?void 0:r.error)||"Erro ao importar dados")}else o.error("Arquivo deve ser do tipo JSON ou TXT")}}),a.jsxs(s,{variant:"outline",type:"button",onClick:()=>{const e=document.getElementById("import-file");e&&e.click()},children:[a.jsx(d,{className:"h-4 w-4 mr-2"}),"Importar Dados"]})]}),a.jsxs(s,{variant:"outline",onClick:async()=>{var a,s;if(confirm("Tem certeza que deseja limpar todos os dados? Esta ação não pode ser desfeita."))try{await e.clearData(),o.success("Dados limpos com sucesso!"),z()}catch(t){o.error((null==(s=null==(a=t.response)?void 0:a.data)?void 0:s.error)||"Erro ao limpar dados")}},className:"text-red-600 border-red-300 hover:bg-red-50",children:[a.jsx(h,{className:"h-4 w-4 mr-2"}),"Limpar Dados"]})]})]}),a.jsx("div",{className:"bg-white p-6 rounded-lg shadow",children:a.jsxs("div",{className:"relative",children:[a.jsx(v,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-5 w-5"}),a.jsx("input",{type:"text",placeholder:"Buscar por nome ou código...",value:k,onChange:e=>S(e.target.value),className:"pl-10 pr-4 py-2 w-full border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})}),a.jsx("div",{className:"bg-white rounded-lg shadow",children:a.jsx(l,{data:N,columns:J,loading:P,emptyMessage:"Nenhum produto encontrado"})}),a.jsx(i,{isOpen:O,onClose:()=>T(!1),title:"Criar Novo Produto",children:a.jsxs("div",{className:"space-y-4",children:[a.jsx(t,{label:"Código do Produto",value:U.codigo,onChange:e=>M({...U,codigo:e.target.value}),placeholder:"Digite o código do produto (10 dígitos)",maxLength:10}),a.jsx(t,{label:"Nome do Produto",value:U.name,onChange:e=>M({...U,name:e.target.value}),placeholder:"Digite o nome do produto"}),a.jsx(t,{label:"Preço (R$)",type:"number",step:"0.01",min:"0",value:U.price,onChange:e=>M({...U,price:parseFloat(e.target.value)||0}),placeholder:"0.00"}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Posição no Painel"}),a.jsx("select",{value:U.position,onChange:e=>M({...U,position:parseInt(e.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:W.map(e=>a.jsxs("option",{value:e,children:["Posição ",e]},e))})]}),a.jsxs("div",{className:"flex items-center",children:[a.jsx("input",{type:"checkbox",id:"create_is_active",checked:U.is_active,onChange:e=>M({...U,is_active:e.target.checked}),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),a.jsx("label",{htmlFor:"create_is_active",className:"ml-2 block text-sm text-gray-900",children:"Produto ativo"})]}),a.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[a.jsx(s,{variant:"outline",onClick:()=>T(!1),children:"Cancelar"}),a.jsx(s,{onClick:async()=>{var a,s;const t=e.validateProductData(U);if(t.length>0)t.forEach(e=>o.error(e));else try{await e.createProduct(U),o.success("Produto criado com sucesso!"),T(!1),M({name:"",price:0,position:1,is_active:!0,codigo:""}),z()}catch(r){o.error((null==(s=null==(a=r.response)?void 0:a.data)?void 0:s.error)||"Erro ao criar produto")}},children:"Criar Produto"})]})]})}),a.jsx(i,{isOpen:_,onClose:()=>E(!1),title:"Editar Produto",children:a.jsxs("div",{className:"space-y-4",children:[a.jsx(t,{label:"Código do Produto",value:X.codigo||"",onChange:e=>F({...X,codigo:e.target.value}),placeholder:"Digite o código do produto (10 dígitos)",maxLength:10}),a.jsx(t,{label:"Nome do Produto",value:X.name||"",onChange:e=>F({...X,name:e.target.value}),placeholder:"Digite o nome do produto"}),a.jsx(t,{label:"Preço (R$)",type:"number",step:"0.01",min:"0",value:X.price||0,onChange:e=>F({...X,price:parseFloat(e.target.value)||0}),placeholder:"0.00"}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Posição no Painel"}),a.jsx("select",{value:X.position||1,onChange:e=>F({...X,position:parseInt(e.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[...W,null==D?void 0:D.position].filter(Boolean).sort((e,a)=>e-a).map(e=>a.jsxs("option",{value:e,children:["Posição ",e]},e))})]}),a.jsxs("div",{className:"flex items-center",children:[a.jsx("input",{type:"checkbox",id:"edit_is_active",checked:X.is_active??!0,onChange:e=>F({...X,is_active:e.target.checked}),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),a.jsx("label",{htmlFor:"edit_is_active",className:"ml-2 block text-sm text-gray-900",children:"Produto ativo"})]}),a.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[a.jsx(s,{variant:"outline",onClick:()=>E(!1),children:"Cancelar"}),a.jsx(s,{onClick:async()=>{var a,s;if(!D)return;const t=e.validateProductData(X);if(t.length>0)t.forEach(e=>o.error(e));else try{await e.updateProduct(D.id,X),o.success("Produto atualizado com sucesso!"),E(!1),I(null),F({}),z()}catch(r){o.error((null==(s=null==(a=r.response)?void 0:a.data)?void 0:s.error)||"Erro ao atualizar produto")}},children:"Salvar Alterações"})]})]})}),a.jsx(i,{isOpen:L,onClose:()=>R(!1),title:"Configurações do Painel",size:"lg",children:a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"space-y-4",children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Textos do Painel"}),a.jsx(t,{label:"Título Principal",value:H.title,onChange:e=>B({...H,title:e.target.value}),placeholder:"Ex: Açougue Premium"}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Texto do Rodapé"}),a.jsx("textarea",{value:H.footer_text,onChange:e=>B({...H,footer_text:e.target.value}),placeholder:"Ex: Horário de funcionamento: Segunda a Sábado das 7h às 19h",rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),a.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[a.jsx(s,{variant:"outline",onClick:()=>R(!1),children:"Cancelar"}),a.jsx(s,{onClick:async()=>{var a,s;try{await e.updateConfig(H),o.success("Configuração salva com sucesso!"),R(!1),q()}catch(t){o.error((null==(s=null==(a=t.response)?void 0:a.data)?void 0:s.error)||"Erro ao salvar configuração")}},children:"Salvar Configurações"})]})]})})]})})};function f(){return a.jsx(b,{})}export{f as default};
