import{j as e,c as a,u as s,B as r,I as t,t as l}from"./index-DgiuPnKP.js";import{r as i}from"./vendor-DaJCiAzA.js";import{C as d,u as n}from"./userService-EonTSjug.js";import{T as c,M as o}from"./Modal-C5T-U6VA.js";import{C as m}from"./Layout-B3msiOoc.js";import{P as x,U as u,i as h,j as g,d as j,g as p,k as v,l as y,f as b}from"./ui-CTO2A6V9.js";import"./router-C-K4H33B.js";import"./Header-CwMlxLm9.js";function f({children:s,variant:r="default",size:t="md",dot:l=!1,className:i}){const d={default:"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300",primary:"bg-primary-100 text-primary-800 dark:bg-primary-900 dark:text-primary-300",success:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300",warning:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300",danger:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300",info:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300"};return l?e.jsxs("span",{className:a("inline-flex items-center gap-1.5",i),children:[e.jsx("span",{className:a("w-2 h-2 rounded-full",d[r].split(" ")[0])}),s]}):e.jsx("span",{className:a("inline-flex items-center font-medium rounded-full",d[r],{sm:"px-2 py-0.5 text-xs",md:"px-2.5 py-1 text-sm",lg:"px-3 py-1.5 text-base"}[t],i),children:s})}const N=()=>{const[a,N]=i.useState([]),[k,w]=i.useState(!0),[C,U]=i.useState(""),[S,E]=i.useState(!1),[A,P]=i.useState(!1),[z,q]=i.useState(null),[D,B]=i.useState({name:"",email:"",password:"",role:"user",active:!0}),[I,T]=i.useState(!1),{user:G}=s(),L=async()=>{try{w(!0);const e=await n.getUsers(1,100,C),a=(null==e?void 0:e.data)||e||[];N(Array.isArray(a)?a:[])}catch(e){l.error("Erro ao carregar usuários"),N([])}finally{w(!1)}};i.useEffect(()=>{L()},[C]);const M=a=>"admin"===a?e.jsx(g,{className:"w-4 h-4"}):e.jsx(h,{className:"w-4 h-4"}),O=[{key:"usuario",label:"Usuário",render:a=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-medium",children:a.name.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:a.name}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:a.email})]})]})},{key:"papel",label:"Papel",render:a=>{return e.jsxs(f,{variant:(s=a.role,"admin"===s?"destructive":"secondary"),className:"flex items-center gap-1 w-fit",children:[M(a.role),"admin"===a.role?"Administrador":"Usuário"]});var s}},{key:"status",label:"Status",render:a=>e.jsx(f,{variant:a.active?"success":"secondary",children:a.active?"Ativo":"Inativo"})},{key:"created_at",label:"Cadastrado em",render:a=>e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:new Date(a.created_at).toLocaleDateString("pt-BR")})},{key:"actions",label:"Ações",render:a=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(r,{variant:"ghost",size:"sm",onClick:()=>{return q(e=a),B({name:e.name,email:e.email,password:"",role:e.role,active:e.active}),void P(!0);var e},title:"Editar usuário",children:e.jsx(p,{className:"w-4 h-4"})}),e.jsx(r,{variant:"ghost",size:"sm",onClick:()=>(async e=>{if(e.id!==(null==G?void 0:G.id))try{await n.toggleUserStatus(e.id,!e.active),l.success(`Usuário ${e.active?"desativado":"ativado"} com sucesso!`),await L()}catch(a){const e=a instanceof Error?a.message:"Erro ao alterar status do usuário";l.error(e)}else l.error("Você não pode alterar o status da sua própria conta")})(a),disabled:a.id===(null==G?void 0:G.id),title:a.active?"Desativar usuário":"Ativar usuário",children:a.active?e.jsx(v,{className:"w-4 h-4"}):e.jsx(y,{className:"w-4 h-4"})}),e.jsx(r,{variant:"ghost",size:"sm",onClick:()=>(async e=>{if(e.id!==(null==G?void 0:G.id)){if(window.confirm(`Tem certeza que deseja deletar o usuário ${e.name}?`))try{await n.deleteUser(e.id),l.success("Usuário deletado com sucesso!"),await L()}catch(a){const e=a instanceof Error?a.message:"Erro ao deletar usuário";l.error(e)}}else l.error("Você não pode deletar sua própria conta")})(a),disabled:a.id===(null==G?void 0:G.id),title:"Deletar usuário",children:e.jsx(b,{className:"w-4 h-4"})})]})}],V=(a||[]).filter(e=>e.active).length,$=(a||[]).filter(e=>"admin"===e.role).length;return k?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Carregando usuários..."})]})}):e.jsx(m,{animation:"fade",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Gerenciamento de Usuários"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Gerencie usuários, permissões e acessos do sistema"})]}),e.jsxs(r,{onClick:()=>E(!0),children:[e.jsx(x,{className:"w-4 h-4 mr-2"}),"Novo Usuário"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(d,{children:e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Total de Usuários"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:(a||[]).length})]}),e.jsx("div",{className:"p-3 bg-blue-100 dark:bg-blue-900/20 rounded-lg",children:e.jsx(u,{className:"w-6 h-6 text-blue-600"})})]})})}),e.jsx(d,{children:e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Usuários Ativos"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:V})]}),e.jsx("div",{className:"p-3 bg-green-100 dark:bg-green-900/20 rounded-lg",children:e.jsx(h,{className:"w-6 h-6 text-green-600"})})]})})}),e.jsx(d,{children:e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Administradores"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:$})]}),e.jsx("div",{className:"p-3 bg-red-100 dark:bg-red-900/20 rounded-lg",children:e.jsx(g,{className:"w-6 h-6 text-red-600"})})]})})})]}),e.jsx(d,{children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Usuários Cadastrados"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(j,{className:"w-4 h-4 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx(t,{placeholder:"Buscar usuários...",value:C,onChange:e=>U(e.target.value),className:"pl-10 w-64"})]}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[(a||[]).length," usuários encontrados"]})]})]}),e.jsx(c,{data:a||[],columns:O,pagination:{currentPage:1,totalPages:1,totalItems:(a||[]).length,itemsPerPage:10}})]})}),e.jsx(o,{isOpen:S,onClose:()=>E(!1),title:"Criar Novo Usuário",children:e.jsxs("form",{onSubmit:async e=>{e.preventDefault(),T(!0);try{await n.createUser(D),l.success("Usuário criado com sucesso!"),E(!1),B({name:"",email:"",password:"",role:"user",active:!0}),await L()}catch(a){const e=a instanceof Error?a.message:"Erro ao criar usuário";l.error(e)}finally{T(!1)}},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Nome"}),e.jsx(t,{value:D.name,onChange:e=>B({...D,name:e.target.value}),placeholder:"Nome completo",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Email"}),e.jsx(t,{type:"email",value:D.email,onChange:e=>B({...D,email:e.target.value}),placeholder:"email@exemplo.com",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Senha"}),e.jsx(t,{type:"password",value:D.password,onChange:e=>B({...D,password:e.target.value}),placeholder:"Senha do usuário",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Papel"}),e.jsxs("select",{value:D.role,onChange:e=>B({...D,role:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white",children:[e.jsx("option",{value:"user",children:"Usuário"}),e.jsx("option",{value:"admin",children:"Administrador"})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:D.active,onChange:e=>B({...D,active:e.target.checked}),className:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("label",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:"Usuário ativo"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx(r,{type:"button",variant:"outline",onClick:()=>E(!1),children:"Cancelar"}),e.jsx(r,{type:"submit",disabled:I,children:I?"Criando...":"Criar Usuário"})]})]})}),e.jsx(o,{isOpen:A,onClose:()=>P(!1),title:"Editar Usuário",children:e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),z){T(!0);try{const e={name:D.name,email:D.email,role:D.role,active:D.active};D.password&&(e.password=D.password),await n.updateUser(z.id,e),l.success("Usuário atualizado com sucesso!"),P(!1),q(null),B({name:"",email:"",password:"",role:"user",active:!0}),await L()}catch(a){const e=a instanceof Error?a.message:"Erro ao atualizar usuário";l.error(e)}finally{T(!1)}}},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Nome"}),e.jsx(t,{value:D.name,onChange:e=>B({...D,name:e.target.value}),placeholder:"Nome completo",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Email"}),e.jsx(t,{type:"email",value:D.email,onChange:e=>B({...D,email:e.target.value}),placeholder:"email@exemplo.com",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Nova Senha (deixe em branco para manter a atual)"}),e.jsx(t,{type:"password",value:D.password,onChange:e=>B({...D,password:e.target.value}),placeholder:"Nova senha (opcional)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Papel"}),e.jsxs("select",{value:D.role,onChange:e=>B({...D,role:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white",children:[e.jsx("option",{value:"user",children:"Usuário"}),e.jsx("option",{value:"admin",children:"Administrador"})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:D.active,onChange:e=>B({...D,active:e.target.checked}),className:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("label",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:"Usuário ativo"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx(r,{type:"button",variant:"outline",onClick:()=>P(!1),children:"Cancelar"}),e.jsx(r,{type:"submit",disabled:I,children:I?"Salvando...":"Salvar Alterações"})]})]})})]})})};export{N as default};
