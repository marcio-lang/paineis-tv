import{j as e,B as a,I as s,t,p as r,A as l}from"./index-DgiuPnKP.js";import{r as i}from"./vendor-DaJCiAzA.js";import{T as d,M as c}from"./Modal-C5T-U6VA.js";import{C as n}from"./Layout-B3msiOoc.js";import{a as o}from"./actionService-mo207Oky.js";import{P as m,E as x,h,f as g,d as u,e as p,L as j,g as v}from"./ui-CTO2A6V9.js";import"./router-C-K4H33B.js";import"./Header-CwMlxLm9.js";const N=()=>{const[N,y]=i.useState([]),[f,b]=i.useState([]),[w,_]=i.useState([]),[C,A]=i.useState(!0),[k,S]=i.useState(""),[E,F]=i.useState(!1),[I,D]=i.useState(!1),[z,P]=i.useState(!1),[$,L]=i.useState(!1),[M,q]=i.useState(null),[G,T]=i.useState({name:"",start_date:"",end_date:"",has_border:!1,panel_ids:[]}),[O,B]=i.useState([]),[J,R]=i.useState([]),[U,W]=i.useState({}),[H,K]=i.useState([]),[Q,V]=i.useState(""),[X,Y]=i.useState([]),[Z,ee]=i.useState(!1),ae=async()=>{try{A(!0);const e=await o.getActions();y(e||[]),_(e||[])}catch(e){t.error("Erro ao carregar ações"),y([]),_([])}finally{A(!1)}};i.useEffect(()=>{if(k){const e=(N||[]).filter(e=>e.name.toLowerCase().includes(k.toLowerCase())||e.description.toLowerCase().includes(k.toLowerCase()));_(e)}else _(N||[])},[k,N]);const se=async e=>{try{const a=await o.getActionImages(e);K(a||[])}catch(a){t.error("Erro ao carregar imagens da ação"),K([])}},te=async e=>{try{const a=await o.getActionPanels(e),s=(f||[]).filter(e=>(a||[]).includes(e.id));Y(s)}catch(a){t.error("Erro ao carregar painéis da ação"),Y([])}};i.useEffect(()=>{ae(),(async()=>{try{const e=await r.getPanels();b(e||[])}catch(e){b([])}})()},[]);const re=[{key:"name",label:"Nome",render:a=>e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:a.name}),e.jsx("div",{className:"text-sm text-gray-500 truncate max-w-xs",children:a.description})]})},{key:"period",label:"Período",render:a=>e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{children:["Início: ",o.formatDateForDisplay(a.start_date)]}),e.jsxs("div",{children:["Fim: ",o.formatDateForDisplay(a.end_date)]})]})},{key:"status",label:"Status",render:a=>{const s=o.getActionStatus(a);return e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${{active:"bg-green-100 text-green-800",inactive:"bg-gray-100 text-gray-800",expired:"bg-red-100 text-red-800",scheduled:"bg-blue-100 text-blue-800"}[s]}`,children:{active:"Ativa",inactive:"Inativa",expired:"Expirada",scheduled:"Agendada"}[s]})}},{key:"created_at",label:"Criado em",render:e=>o.formatDateForDisplay(e.created_at)},{key:"actions",label:"Ações",render:s=>e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(a,{variant:"ghost",size:"sm",onClick:()=>(e=>{q(e),L(!0),te(e.id)})(s),className:"text-purple-600 hover:text-purple-700",children:e.jsx(j,{className:"h-4 w-4"})}),e.jsx(a,{variant:"ghost",size:"sm",onClick:()=>(e=>{q(e),P(!0),se(e.id)})(s),className:"text-blue-600 hover:text-blue-700",children:e.jsx(p,{className:"h-4 w-4"})}),e.jsx(a,{variant:"ghost",size:"sm",onClick:()=>(e=>{q(e),W({name:e.name,start_date:e.start_date,end_date:e.end_date,has_border:e.has_border}),D(!0)})(s),className:"text-yellow-600 hover:text-yellow-700",children:e.jsx(v,{className:"h-4 w-4"})}),e.jsx(a,{variant:"ghost",size:"sm",onClick:()=>(async e=>{var a,s;if(confirm(`Tem certeza que deseja deletar a ação "${e.name}"?`))try{await o.deleteAction(e.id),t.success("Ação deletada com sucesso!"),ae()}catch(r){t.error((null==(s=null==(a=r.response)?void 0:a.data)?void 0:s.error)||"Erro ao deletar ação")}})(s),className:"text-red-600 hover:text-red-700",children:e.jsx(g,{className:"h-4 w-4"})})]})}],le=(N||[]).filter(e=>"active"===o.getActionStatus(e)),ie=(N||[]).filter(e=>!e.is_active),de=(N||[]).filter(e=>"expired"===o.getActionStatus(e));return e.jsx(n,{animation:"fade",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Gerenciar Ações"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Gerencie as ações e suas associações com painéis"})]}),e.jsxs(a,{onClick:()=>F(!0),children:[e.jsx(m,{className:"h-4 w-4 mr-2"}),"Nova Ação"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-white p-6 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(x,{className:"h-6 w-6 text-blue-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total de Ações"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:(N||[]).length})]})]})}),e.jsx("div",{className:"bg-white p-6 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(m,{className:"h-6 w-6 text-green-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Ações Ativas"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:(le||[]).length})]})]})}),e.jsx("div",{className:"bg-white p-6 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-gray-100 rounded-lg",children:e.jsx(h,{className:"h-6 w-6 text-gray-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Inativas"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:(ie||[]).length})]})]})}),e.jsx("div",{className:"bg-white p-6 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-red-100 rounded-lg",children:e.jsx(g,{className:"h-6 w-6 text-red-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Expiradas"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:(de||[]).length})]})]})})]}),e.jsx("div",{className:"bg-white p-6 rounded-lg shadow",children:e.jsxs("div",{className:"relative",children:[e.jsx(u,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-5 w-5"}),e.jsx("input",{type:"text",placeholder:"Buscar ações...",value:k,onChange:e=>S(e.target.value),className:"pl-10 pr-4 py-2 w-full border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow",children:e.jsx(d,{data:w||[],columns:re,loading:C,emptyMessage:"Nenhuma ação encontrada"})}),e.jsx(c,{isOpen:E,onClose:()=>F(!1),title:"Criar Nova Ação",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(s,{label:"Nome da Ação",value:G.name,onChange:e=>T({...G,name:e.target.value}),placeholder:"Digite o nome da ação"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Painéis * (selecione um ou mais)"}),e.jsxs("div",{className:"space-y-2 max-h-32 overflow-y-auto border border-gray-300 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"select-all-panels",checked:O.length===f.length,onChange:e=>{e.target.checked?B(f.map(e=>e.id)):B([])},className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:"select-all-panels",className:"ml-2 text-sm font-medium text-gray-900",children:"Marcar todos"})]}),f.map(a=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:`panel-${a.id}`,checked:O.includes(a.id),onChange:e=>{e.target.checked?B([...O,a.id]):B(O.filter(e=>e!==a.id))},className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsxs("label",{htmlFor:`panel-${a.id}`,className:"ml-2 text-sm text-gray-900",children:[a.name," (",a.layout_type,")"]})]},a.id))]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(s,{label:"Data de Início",type:"datetime-local",value:G.start_date,onChange:e=>T({...G,start_date:e.target.value})}),e.jsx(s,{label:"Data de Fim",type:"datetime-local",value:G.end_date,onChange:e=>T({...G,end_date:e.target.value})})]}),e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("input",{type:"checkbox",id:"has_border",checked:G.has_border,onChange:e=>T({...G,has_border:e.target.checked}),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded mt-1"}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"has_border",className:"text-sm font-medium text-gray-900",children:"Usar bordas nas imagens (layout 2x2)"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Com bordas: imagem encaixada em container com borda. Sem bordas: imagem otimizada para máximo espaço."})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Imagens * (",J.length,")"]}),e.jsx("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx(p,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("label",{htmlFor:"create-image-upload",className:"cursor-pointer",children:[e.jsx("span",{className:"mt-2 block text-sm font-medium text-gray-900",children:"Clique para adicionar imagens"}),e.jsx("span",{className:"mt-1 block text-sm text-gray-500",children:"Adicione quantas imagens desejar"})]}),e.jsx("input",{id:"create-image-upload",type:"file",className:"hidden",accept:"image/*",multiple:!0,onChange:e=>{if(e.target.files){const a=Array.from(e.target.files);R([...J,...a])}}})]})]})}),J.length>0&&e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-900",children:["Imagens selecionadas (",J.length,")"]}),e.jsx("div",{className:"space-y-2 max-h-32 overflow-y-auto",children:J.map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded",children:[e.jsx("span",{className:"text-sm text-gray-700 truncate",children:s.name}),e.jsx(a,{variant:"ghost",size:"sm",onClick:()=>{R(J.filter((e,a)=>a!==t))},className:"text-red-600 hover:text-red-700",children:e.jsx(g,{className:"h-4 w-4"})})]},t))})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx(a,{variant:"outline",onClick:()=>{F(!1),B([]),R([]),T({name:"",start_date:"",end_date:"",has_border:!1,panel_ids:[]})},children:"Cancelar"}),e.jsx(a,{onClick:async()=>{var e,a;if(G.name.trim())if(G.start_date)if(G.end_date)if(0!==O.length)if(0!==J.length)try{const e=e=>e&&e.match(/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}$/)?e+":00":e,a={...G,start_date:e(G.start_date),end_date:e(G.end_date),panel_ids:O},s=await o.createAction(a);if(!s)throw new Error("Falha ao criar ação - resposta vazia do servidor");if(!s.id)throw new Error("Falha ao criar ação - ID não retornado pelo servidor");if(J.length>0){const e=J.map(e=>({img:e,errs:o.validateImageFile(e)})).filter(e=>e.errs.length>0);e.length>0?e.forEach(e=>e.errs.forEach(e=>t.error(e))):await o.uploadActionImages(s.id,J)}t.success("Ação criada com sucesso!"),F(!1),T({name:"",start_date:"",end_date:"",has_border:!1,panel_ids:[]}),B([]),R([]),await ae()}catch(s){t.error((null==(a=null==(e=s.response)?void 0:e.data)?void 0:a.error)||"Erro ao criar ação")}else t.error("Adicione pelo menos uma imagem");else t.error("Selecione pelo menos um painel");else t.error("Data de fim é obrigatória");else t.error("Data de início é obrigatória");else t.error("Nome da ação é obrigatório")},children:"Criar"})]})]})}),e.jsx(c,{isOpen:I,onClose:()=>D(!1),title:"Editar Ação",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(s,{label:"Nome da Ação",value:U.name||"",onChange:e=>W({...U,name:e.target.value}),placeholder:"Digite o nome da ação"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Descrição"}),e.jsx("textarea",{value:U.description||"",onChange:e=>W({...U,description:e.target.value}),placeholder:"Digite a descrição da ação",rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(s,{label:"Data de Início",type:"date",value:U.start_date||"",onChange:e=>W({...U,start_date:e.target.value})}),e.jsx(s,{label:"Data de Fim",type:"date",value:U.end_date||"",onChange:e=>W({...U,end_date:e.target.value})})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"edit_is_active",checked:U.is_active??!0,onChange:e=>W({...U,is_active:e.target.checked}),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:"edit_is_active",className:"ml-2 block text-sm text-gray-900",children:"Ação ativa"})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx(a,{variant:"outline",onClick:()=>D(!1),children:"Cancelar"}),e.jsx(a,{onClick:async()=>{var e,a;if(!M)return;const s=o.validateActionData(U);if(s.length>0)s.forEach(e=>t.error(e));else try{await o.updateAction(M.id,U),t.success("Ação atualizada com sucesso!"),D(!1),q(null),W({}),ae()}catch(r){t.error((null==(a=null==(e=r.response)?void 0:e.data)?void 0:a.error)||"Erro ao atualizar ação")}},children:"Salvar Alterações"})]})]})}),e.jsx(c,{isOpen:z,onClose:()=>P(!1),title:`Imagens da Ação: ${null==M?void 0:M.name}`,size:"lg",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx(p,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("label",{htmlFor:"image-upload",className:"cursor-pointer",children:[e.jsx("span",{className:"mt-2 block text-sm font-medium text-gray-900",children:"Clique para enviar imagem/vídeo"}),e.jsx("span",{className:"mt-1 block text-sm text-gray-500",children:"PNG, JPG, JPEG, WEBP, GIF, MP4, WebM ou Ogg até 150MB"})]}),e.jsx("input",{id:"image-upload",type:"file",className:"hidden",accept:"image/*,video/mp4,video/webm,video/ogg",multiple:!0,onChange:async e=>{var a;if(!M||!(null==(a=e.target.files)?void 0:a.length))return;const s=Array.from(e.target.files),r=s.map(e=>({f:e,errs:o.validateImageFile(e)})).filter(e=>e.errs.length>0);if(r.length>0)r.forEach(e=>e.errs.forEach(e=>t.error(e)));else try{ee(!0),await o.uploadActionImages(M.id,s),t.success("Imagem enviada com sucesso!"),se(M.id)}catch(i){const e=i instanceof l?i.message:(null==i?void 0:i.message)||"Erro ao enviar imagem";t.error(e)}finally{ee(!1)}},disabled:Z})]}),Z&&e.jsx("div",{className:"mt-4",children:e.jsx("div",{className:"text-sm text-blue-600",children:"Enviando..."})})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900",children:["Imagens (",(H||[]).length,")"]}),0===(H||[]).length?e.jsx("p",{className:"text-gray-500 text-center py-8",children:"Nenhuma imagem encontrada"}):e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:(H||[]).map(s=>e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"aspect-square bg-gray-100 rounded-lg overflow-hidden",children:e.jsx("img",{src:`${s.url}`,alt:s.filename,className:"w-full h-full object-cover"})}),e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity rounded-lg flex items-center justify-center",children:e.jsx(a,{variant:"ghost",size:"sm",onClick:()=>(async e=>{var a,s;if(M&&confirm("Tem certeza que deseja deletar esta imagem?"))try{await o.deleteActionImage(M.id,e),t.success("Imagem deletada com sucesso!"),se(M.id)}catch(r){t.error((null==(s=null==(a=r.response)?void 0:a.data)?void 0:s.error)||"Erro ao deletar imagem")}})(s.id),className:"text-white hover:text-red-300",children:e.jsx(g,{className:"h-4 w-4"})})}),e.jsx("p",{className:"mt-2 text-xs text-gray-600 truncate",children:s.filename})]},s.id))})]})]})}),e.jsx(c,{isOpen:$,onClose:()=>L(!1),title:`Painéis Associados: ${null==M?void 0:M.name}`,size:"lg",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Selecione os painéis onde esta ação deve ser exibida"}),e.jsx("div",{className:"space-y-3",children:(f||[]).map(s=>{const r=(X||[]).some(e=>e.id===s.id);return e.jsxs("div",{className:"flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:bg-gray-50",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:s.name}),e.jsxs("div",{className:"text-sm text-gray-500",children:["URL: ",s.fixed_url]})]}),e.jsx(a,{variant:r?"outline":"default",size:"sm",onClick:()=>(async e=>{var a,s;if(!M)return;const r=(X||[]).some(a=>a.id===e);try{r?(await o.removeActionFromPanel(M.id,e),t.success("Ação removida do painel!")):(await o.addActionToPanel(M.id,e),t.success("Ação adicionada ao painel!")),te(M.id)}catch(l){t.error((null==(s=null==(a=l.response)?void 0:a.data)?void 0:s.error)||"Erro ao alterar associação")}})(s.id),className:r?"text-red-600 border-red-300 hover:bg-red-50":"",children:r?e.jsxs(e.Fragment,{children:[e.jsx(h,{className:"h-4 w-4 mr-2"}),"Remover"]}):e.jsxs(e.Fragment,{children:[e.jsx(j,{className:"h-4 w-4 mr-2"}),"Associar"]})})]},s.id)})}),0===f.length&&e.jsx("p",{className:"text-gray-500 text-center py-8",children:"Nenhum painel disponível"})]})})]})})};function y(){return e.jsx(N,{})}export{y as default};
